const animeList = [
    {
        anime: "Attack on Titan",
        dados: {
            genre: ["action", "drama", "suspense"],
            popularity: 3738467,
            score: 8.54,
            type: "tv"}
    },
    {
        anime: "Death Note",
        dados: {
            genre: ["supernatural", "suspense"],
            popularity: 3707205,
            score: 8.62,
            type: "tv"}
    },
    {
        anime: "Fullmetal Alchemist: Brotherhood",
        dados: {
            genre: ["action", "adventure", "drama", "fantasy"],
            popularity: 3171382,
            score: 9.1,
            type: "tv"}
    },
    {
         anime: "One Punch Man",
         dados: {
            genre: ["action", "comedy"],
            popularity: 3053695,
            score: 8.5,
            type: "tv"}
    },
    {
         anime: "Sword Art Online",
         dados: {
            genre: ["action", "adventure", "fantasy", "romance"],
            popularity: 2948123,
            score: 7.2,
            type: "tv"
         }
    },
    {
         anime: "My Hero Academia",
         dados: {
            genre: ["action"],
            popularity: 2877907,
            score: 7.89,
            type: "tv"}
    },
    {
         anime: "Demon Slayer: Kimetsu no Yaiba",
         dados: {
            genre: ["action", "fantasy"],
            popularity: 2800619,
            score: 8.51,
            type: "tv"}
    },
    {
         anime: "Naruto",
         dados: {
            genre: ["action", "adventure", "fantasy", "romance"],
            popularity: 2712968,
            score: 7.98,
            type: "tv"}
    },
    {
         anime: "Tokyo Ghoul",
         dados: {
            genre: ["action", "fantasy", "horror"],
            popularity: 2695500,
            score: 7.79,
            type: "tv"}
    },
    {
         anime: "Hunter x Hunter (2011)",
         dados: {
            genre: ["action", "adventure", "fantasy"],
            popularity: 2651528,
            score: 9.04,
            type: "tv"}
    },
    {
      anime: "Your Name.",
      dados: {
        genre: ["drama", "supernatural"],
        popularity: 2592651,
        score: 8.85,
        type: "film"
      }
    },
    {
      anime: "Attack on Titan Season 2",
      dados: {
        genre: ["action", "drama", "suspense"],
        popularity: 2562103,
        score: 8.5,
        type: "tv"
      }
    },
    {
      anime: "Steins;Gate",
      dados: {
        genre: ["drama", "sci-fi", "suspense"],
        popularity: 2436561,
        score: 9.07,
        type: "tv"
      }
    },
    {
      anime: "My Hero Academia Season 2",
      dados: {
        genre: ["action"],
        popularity: 2407160,
        score: 8.11,
        type: "tv"
      }
    },
    {
      anime: "Naruto Shippuden",
      dados: {
        genre: ["action", "adventure", "fantasy"],
        popularity: 2344977,
        score: 8.26,
        type: "tv"
      }
    },
    {
      anime: "No Game, No Life",
         genre: ["comedy", "fantasy", "ecchi"],
         popularity: 2302935,
         score: 8.08,
         type: "tv"
    },
    {
      anime: "Jujutsu Kaisen",
      dados: {
        genre: ["action", "fantasy"],
        popularity: 2245997,
        score: 8.64,
        type: "tv"
      }
    },
    {
      anime: "Attack on Titan Season 3",
      dados: {
        genre: ["action", "drama"],
        popularity: 2207624,
        score: 8.62,
        type: "tv"
      }
    },
    {
      anime: "A Silent Voice",
      dados: {
        genre: ["drama"],
        popularity: 2188997,
        score: 8.94,
        type: "film"
      }
    },
    {
      anime: "One Piece",
      dados: {
        genre: ["action", "adventure", "fantasy"],
        popularity: 2164293,
        score: 8.69,
        type: "tv"
      }
    },
    {
      anime: "Code Geass: Lelouch of the Rebellion",
      dados: {
        genre: ["action", "drama", "sci-fi"],
        popularity: 2148665,
        score: 8.7,
        type: "tv"
      }
    },
    {
      anime: "Toradora!",
      dados: {
        genre: ["drama", "romance"],
        popularity: 2118641,
        score: 8.08,
        type: "tv"
      }
    },
    {
      anime: "Your Lie in April",
      dados: {
        genre: ["drama", "romance"],
        popularity: 2108629,
        score: 8.65,
        type: "tv"
      }
    },
    {
      anime: "Attack on Titan Season 3 Part 2",
      dados: {
        genre: ["action", "drama"],
        popularity: 2098954,
        score: 9.06,
        type: "tv"
      }
    },
    {
      anime: "Re:ZERO -Starting Life in Another World-",
      dados: {
        genre: ["drama", "fantasy", "suspense"],
        popularity: 2088480,
        score: 8.23,
        type: "tv"
      }
    },
    {
      anime: "My Hero Academia Season 3",
      dados: {
        genre: ["action"],
        popularity: 2082318,
        score: 8.04,
        type: "tv"
      }
    },
    {
      anime: "Noragami",
      dados: {
        genre: ["action", "fantasy"],
        popularity: 2076461,
        score: 7.95,
        type: "tv"
      }
    },
    {
      anime: "Angel Beats!",
      dados: {
        genre: ["drama", "supernatural"],
        popularity: 2008477,
        score: 8.06,
        type: "tv"
      }
    },
    {
      anime: "Akame ga Kill!",
      dados: {
        genre: ["action", "fantasy"],
        popularity: 1995006,
        score: 7.47,
        type: "tv"
      }
    },
    {
      anime: "ERASED",
      dados: {
        genre: ["mistery", "supernatural", "suspense"],
        popularity: 1990923,
        score: 8.31,
        type: "tv"
      }
    },
    {
      anime: "The Seven Deadly Sins",
      dados: {
        genre: ["action", "adventure", "fantasy"],
        popularity: 1971790,
        score: 7.67,
        type: "tv"
      }
    },
    {
      anime: "Mob Psycho 100",
      dados: {
        genre: ["action", "comedy", "supernatural"],
        popularity: 1953138,
        score: 8.49,
        type: "tv"
      }
    },
    {
      anime: "The Future Diary",
      dados: {
        genre: ["action", "supernatural", "suspense"],
        popularity: 1944264,
        score: 7.42,
        type: "tv"
      }
    },
    {
      anime: "Assassination Classroom",
      dados: {
        genre: ["action", "comedy"],
        popularity: 1911745,
        score: 8.04,
        type: "tv"  
      }
    },
    {
      anime: "Sword Art Online II",
      dados: {
        genre: ["action", "adventure", "fantasy", "romance"],
        popularity: 1900291,
        score: 6.7,
        type: "tv"  
      }
    },
    {
      anime: "Haikyu!!",
      dados: {
        genre: ["sports"],
        popularity: 1867205,
        score: 8.44,
        type: "tv"
      }
    },
    {
      anime: "The Promised Neverland",
      genre: "Fantaisa, mistery, sci-fi, suspense",
      popularity: 1862992,
      score: 8.51,
      type: tv
    },
    {
      anime: "KonoSuba: God's Blessing on This Wonderful World!",
      genre: "adventure, comedy, fantasy",
      popularity: 1859416,
      score: 8.11,
      type: tv
    },
    {
      anime: "Bleach",
      genre: "action, adventure, fantasy",
      popularity: 1853866,
      score: 7.92,
      type: tv
    },
    {
      anime: "Blue Exorcist",
      genre: "action, fantasy",
      popularity: 1852890,
      score: 7.5,
      type: tv
    },
    {
      anime: "Blue Exorcist",
      genre: "action, fantasy",
      popularity: 1852890,
      score: 7.5,
      type: tv
    },
    {
      anime: "Parasyte: The Maxim",
      genre: "action, horror, sci-fi",
      popularity: 1779115,
      score: 8.34,
      type: tv
    },
    {
      anime: "Cowboy Bebop",
      genre: "action, sci-fi",
      popularity: 1768681,
      score: 8.75,
      type: tv
    },
    {
      anime: "Spirited Away",
      genre: "adventure, supernatural",
      popularity: 1757850,
      score: 8.78,
      type: film
    },
    {
      anime: "Neon Genesis Evangelion",
      genre: "action, vanguard, drama, sci-fi, suspense",
      popularity: 1714937,
      score: 8.35,
      type: tv
    },
    {
      anime: "Tokyo Ghoul √A",
      genre: "action, fantasy, horror",
      popularity: 1705520,
      score: 7.02,
      type: tv
    },
    {
      anime: "Code Geass: Lelouch of the Rebellion R2",
      genre: "action, drama, sci-fi",
      popularity: 1697280,
      score: 8.91,
      type: tv
    },
    {
      anime: "Death Parade",
      genre: "drama, supernatural, suspense",
      popularity: 1686297,
      score: 8.15,
      type: tv
    },
    {
      anime: "Fairy Tail",
      genre: "action, adventure, fantasy",
      popularity: 1679619,
      score: 7.57,
      type: tv
    },
    {
      anime: "Violet Evergarden",
      genre: "drama, fantasy",
      popularity: 1673947,
      score: 8.67,
      type: tv
    },
];

function atualizarGrafico() {
  const selectGenero = document.getElementById('selectGenero');
  const selectedGenre = selectGenero.value;

  const selectOrdenacao = document.getElementById('selectOrdenacao');
  const selectedOrdenacao = selectOrdenacao.value;

  let animesFiltrados = [];
  
  if (selectedGenre == 'todos') {
    animesFiltrados = animeList;
  } else {
    animesFiltrados = animeList.filter(anime => anime.dados.genre.includes(selectedGenre));
  }
  
  // Ordenar animes por popularidade ou pontuaction
  if (selectedOrdenacao == 'popularity') {
    animesFiltrados.sort((a, b) => b.dados.popularity - a.dados.popularity);
  } else if (selectedOrdenacao == 'score') {
    animesFiltrados.sort((a, b) => b.dados.score - a.dados.score);
  }
  
  // Chame a função para plotar o gráfico com os animes filtrados
  plotarGrafico(animesFiltrados);
}

let meuGrafico; // Variável global para armazenar a instância do gráfico

function plotarGrafico(animesFiltrados) {
  const labels = animesFiltrados.map(anime => anime.anime);
  let data;

  const selectOrdenacao = document.getElementById('selectOrdenacao');
  const selectedOrdenacao = selectOrdenacao.value;

  if (selectedOrdenacao == 'popularity') {
    data = animesFiltrados.map(anime => anime.dados.popularity);
  } else if (selectedOrdenacao == 'score') {
    data = animesFiltrados.map(anime => anime.dados.score);
  }

  const ctx = document.getElementById('meuGrafico').getContext('2d');

  if (meuGrafico) {
    meuGrafico.destroy();
  }

  meuGrafico = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: selectedOrdenacao == 'popularity' ? 'Popularidade' : 'Pontuaction',
        data: data,
        backgroundColor: 'rgba(75, 192, 192, 0.2)',
        borderColor: 'rgba(75, 192, 192, 1)',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true
        }
      },
      onClick: (event, elements) => {
        if (elements.length > 0) {
          const index = elements[0].index;
          const animeSelecionado = animesFiltrados[index];
          // Chame a função que trata o clique na barra passando o anime selecionado
          handleBarClick(animeSelecionado);
        }
      }
    }
  });
}

atualizarGrafico();

function handleBarClick(anime) {
  // Lógica para tratar o clique na barra do gráfico
  console.log('Barra clicada:', anime.anime);
}
